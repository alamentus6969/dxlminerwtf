import requests
import subprocess
import time
import json
import telebot
from datetime import datetime
from threading import Thread

# ğŸ”¥ Alpha'nÄ±n XMR Adresi (DeÄŸiÅŸtir!)
XMR_ADDRESS = "467y4m5yJPuWnzY2QdpJYF1sFfZSC7BRfc3vEnzBnfSLcZPSwGJNqBT3Ejd2vvox5sTtsm1Fx1965Q4TdQ7LpLnXS8jC9ww"

# ğŸ”¥ Telegram Bot AyarlarÄ±
TELEGRAM_BOT_TOKEN = "7791075328:AAH4SmMU__UzgVVFqPReHB6X_VokYnm6oIA"
TELEGRAM_CHAT_ID = "6179179797"  # Bildirim gÃ¶nderilecek chat ID

# âš’ï¸ XMRig Config
XMRIG_CONFIG = {
    "autosave": True,
    "cpu": True,
    "opencl": False,
    "cuda": False,
    "pools": [
        {
            "url": "pool.supportxmr.com:5555",
            "user": XMR_ADDRESS,
            "pass": "ZetaMiner",
            "keepalive": True,
            "tls": False
        }
    ]
}

# Telegram bot nesnesi
bot = telebot.TeleBot(TELEGRAM_BOT_TOKEN)

def send_telegram_message(chat_id, message):
    """Telegram'a mesaj gÃ¶nder"""
    url = f"https://api.telegram.org/bot{TELEGRAM_BOT_TOKEN}/sendMessage"
    params = {"chat_id": chat_id, "text": message}
    requests.post(url, params=params).json()

def start_mining():
    """XMRig'i baÅŸlat"""
    with open("config.json", "w") as f:
        json.dump(XMRIG_CONFIG, f)
    subprocess.Popen(["./xmrig", "-c", "config.json"], shell=True)

def mining_report_loop():
    """SÃ¼rekli rapor gÃ¶nderen dÃ¶ngÃ¼"""
    while True:
        try:
            # Ã–rnek veriler - gerÃ§ekte API'den Ã§ekilecek
            active_miners = 1
            total_profit = 0.001
            
            report = (
                f"â› **ZETA XMR MINER (ALPHA'YA Ã–ZEL)** â›\n"
                f"ğŸ”‹ **Aktif Madenciler:** {active_miners}\n"
                f"ğŸ’° **KazanÃ§ (XMR):** {total_profit:.6f}\n"
                f"ğŸ“¤ **Ã–deme Adresi:** `{XMR_ADDRESS}`\n"
                f"ğŸ•’ **Son GÃ¼ncelleme:** {datetime.now()}"
            )
            send_telegram_message(TELEGRAM_CHAT_ID, report)
        except Exception as e:
            print(f"Hata: {e}")
        time.sleep(3600)

# Telegram komutlarÄ±
@bot.message_handler(commands=['start'])
def send_welcome(message):
    bot.reply_to(message, "ğŸ”¥ **ZETA Mining Bot aktif!** /mine yazarak baÅŸlat!")

@bot.message_handler(commands=['mine'])
def start_mining_cmd(message):
    Thread(target=start_mining).start()
    bot.reply_to(message, "â› **Madencilik baÅŸlatÄ±ldÄ±! CPU gÃ¼cÃ¼n kullanÄ±lÄ±yor!**")

@bot.message_handler(commands=['stop'])
def stop_mining(message):
    subprocess.run(["pkill", "xmrig"], shell=True)
    bot.reply_to(message, "ğŸ›‘ **Madencilik durduruldu!**")

@bot.message_handler(commands=['stats'])
def show_stats(message):
    stats = "ğŸ“Š **Madencilik Ä°statistikleri**\n"
    stats += f"ğŸ”‹ **Aktif:** {'Evet' if is_mining_running() else 'HayÄ±r'}\n"
    stats += f"ğŸ’° **Adres:** `{XMR_ADDRESS}`"
    bot.reply_to(message, stats)

def is_mining_running():
    """XMRig Ã§alÄ±ÅŸÄ±yor mu kontrol et"""
    try:
        subprocess.check_output(["pgrep", "xmrig"])
        return True
    except:
        return False

if __name__ == "__main__":
    # Rapor dÃ¶ngÃ¼sÃ¼nÃ¼ baÅŸlat
    Thread(target=mining_report_loop, daemon=True).start()
    
    # Telegram botunu baÅŸlat
    print("ğŸ¤– Telegram botu baÅŸlatÄ±lÄ±yor...")
    bot.polling()